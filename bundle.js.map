{"version":3,"sources":["webpack:///webpack/bootstrap 34fe4f90cfd82d17ec63","webpack:///./lib/scrape.js"],"names":["profileInformation","numLikers","numAds","numVerticals","document","addEventListener","chrome","runtime","onMessage","addListener","message","console","log","verticals","receiveVerticals","ads","receiveAds","likers","receiveLikers","profile","receiveProfile","getElementById","runScrape","button","disabled","style","opacity","getVerticals","setStatus","tabs","executeScript","file","getAds","verticalTitle","url","create","active","tab","id","code","setTimeout","remove","getLikers","adURL","getProfile","i","length","concat","push","filter","index","self","findIndex","a","profileURL","writeToCSV","csv","convertToCSV","reset","identity","getAuthToken","token","lastError","ajaxToSheets","$","ajax","method","data","requests","pasteData","coordinate","sheedId","rowIndex","columnIndex","type","delimiter","includeSpreadsheetInResponse","responseIncludeGridData","success","error","cToK","columnToKeyMap","headers","result","join","res","j","status","innerText"],"mappings":"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","file":"bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 34fe4f90cfd82d17ec63","let profileInformation = [];\nlet numLikers = 0;\nlet numAds = 0; //Currently 21\nlet numVerticals = 0; //Currently 14\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  chrome.runtime.onMessage.addListener((message) =>{\n    console.log(message);\n    if (message.verticals){\n      receiveVerticals(message.verticals);\n    } else if (message.ads){\n      receiveAds(message.ads);\n    } else if (message.likers) {\n      receiveLikers(message.likers);\n    } else if(message.profile){\n      receiveProfile(message.profile);\n    }\n  });\n\n  document.getElementById('extract-description').addEventListener('click', runScrape);\n});\n\nfunction runScrape(){\n  let button = document.getElementById('extract-description');\n  button.disabled = true;\n  button.style.opacity = '0.7';\n  getVerticals();\n}\n\nfunction getVerticals() {\n  setStatus('Fetching verticals');\n  chrome.tabs.executeScript({file: './lib/pullVerticals.js'});\n}\n\nfunction getAds({verticalTitle, url}) {\n  setStatus('Fetching ads');\n  chrome.tabs.create({url: url, active: false}, (tab) => {\n    chrome.tabs.executeScript(tab.id, {code: `let verticalTitle = '${verticalTitle}'`}, () => {\n      chrome.tabs.executeScript(tab.id, {file: './lib/pullAds.js'}, () => setTimeout(() => chrome.tabs.remove(tab.id), 2500));\n    });\n  });\n}\n\nfunction getLikers({verticalTitle, adURL, url}) {\n  setStatus('Fetching likers');\n  chrome.tabs.create({url: url, active: false}, (tab) => {\n    chrome.tabs.executeScript(tab.id, {code: `let verticalTitle = '${verticalTitle}'; let adURL = '${adURL}'`}, () => {\n      chrome.tabs.executeScript(tab.id, {file: './lib/pullLikers.js'}, () => setTimeout(() => chrome.tabs.remove(tab.id), 3500));\n    });\n  });\n}\n\nfunction getProfile({verticalTitle, adURL, url}){\n  setStatus('Fetching profile information');\n  chrome.tabs.create({url: url, active: false}, (tab) => {\n    chrome.tabs.executeScript(tab.id, {code: `let verticalTitle = '${verticalTitle}'; let adURL = '${adURL}'`}, () => {\n      chrome.tabs.executeScript(tab.id, {file: './lib/pullProfileInfo.js'}, () => setTimeout(() => chrome.tabs.remove(tab.id), 9000));\n    });\n  });\n}\n\nfunction receiveVerticals(verticals){\n  for (let i = 0; i < verticals.length; i++) {\n    setTimeout(() => getAds(verticals[i]), i*3000);\n  }\n}\n\nfunction receiveAds(ads){\n  numAds = numAds.concat(ads);\n  console.log(numAds.length);\n  for (let i = 0; i < ads.length; i++) {\n    setTimeout(() => getLikers(ads[i]), i*4000);\n  }\n}\n\nfunction receiveLikers(likers){\n  numLikers += likers.length;\n  for (let i = 0; i < likers.length; i++) {\n    setTimeout(() => getProfile(likers[i]), i*8000);\n  }\n}\n\nfunction receiveProfile(profile){\n  profileInformation.push(profile);\n  console.log(`verticals: ${numVerticals}  ads: ${numAds}  likers: ${numLikers}   profiles: ${profileInformation.length}`);\n  if (profileInformation.length === 1/*numLikers*/) {\n    profileInformation = profileInformation.filter((profile, index, self) => self.findIndex(a => a.profileURL === profile.profileURL && a.adURL === profile.adURL) === index);\n    console.log(`After filter profiles: ${profileInformation.length}`);\n    writeToCSV();\n  }\n}\n\nfunction writeToCSV(){\n  let csv = convertToCSV();\n  setStatus('Writing CSV');\n  if (!csv) {\n    setStatus('Error creating CSV');\n    reset();\n    return;\n  }\n\n  chrome.identity.getAuthToken({ 'interactive': true }, (token) => {\n    if (chrome.runtime.lastError) {\n      console.log(chrome.runtime.lastError);\n    }\n    ajaxToSheets(csv);\n  });\n}\n\nfunction ajaxToSheets(csv){\n  $.ajax({\n    method: 'POST',\n    url: 'https://sheets.googleapis.com/v4/spreadsheets/1oirryM7Micu6syecPJvmefuQMg64YqFtViaf5pXyo4o:batchUpdate',\n    data: {\n      requests: [{\n        pasteData: {\n          coordinate: {\n            sheedId: 1,\n            rowIndex: 0,\n            columnIndex: 0\n          },\n          data: csv,\n          type: 'PASTE_NORMAL',\n          delimiter: ','\n        }\n      }],\n      includeSpreadsheetInResponse: true,\n      responseIncludeGridData: false\n    },\n    success: () => { setStatus('Completed scrape');},\n    error: (error) => { setStatus('Error writing to sheets'); reset(); console.log(error);}\n  });\n}\n\nfunction convertToCSV(){\n  setStatus('Converting to CSV');\n  if(profileInformation.length === 0) {\n    setStatus('Error - No profiles found');\n    reset();\n    return;\n  }\n\n  let cToK = columnToKeyMap();\n\n  let headers = ['\\\"Profile\\\"', '\\\"First Name\\\"', '\\\"Last Name\\\"', '\\\"Email\\\"', '\\\"Company\\\"', '\\\"Title\\\"', '\\\"Ad\\\"', '\\\"Vertical\\\"'];\n  let result = headers.join(',')+'\\n';\n  for (let i = 0; i < profileInformation.length; i++) {\n    let res = [];\n    for (let j = 0; j < headers.length; j++) {\n      res.push(`\\\"${profileInformation[i][cToK[headers[j]]]}\\\"`);\n    }\n    result += res.join(',')+'\\n';\n  }\n  return result;\n}\n\nfunction columnToKeyMap(){\n  return {\n    '\\\"Profile\\\"': 'profileURL',\n    '\\\"First Name\\\"': 'firstName',\n    '\\\"Last Name\\\"': 'lastName',\n    '\\\"Email\\\"': 'email',\n    '\\\"Company\\\"': 'company',\n    '\\\"Title\\\"': 'title',\n    '\\\"Ad\\\"': 'adURL',\n    '\\\"Vertical\\\"': 'verticalTitle'\n  };\n}\n\nfunction setStatus(status){\n  document.getElementById('status').innerText = status;\n}\n\nfunction reset(){\n  let button = document.getElementById('extract-description');\n  button.disabled = false;\n  button.style.opacity = '1';\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/scrape.js"],"sourceRoot":""}